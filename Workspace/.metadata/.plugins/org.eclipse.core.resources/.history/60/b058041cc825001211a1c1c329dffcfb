package p1;

import gnu.io.CommPortIdentifier;
import gnu.io.SerialPort;

import java.io.IOException;
import java.io.OutputStream;
import java.io.OutputStreamWriter;
import java.util.List;

import p1.SerialPortTools;

public class Server {
	
	private static String commPortName = "COM2";		//TOCHANGE
	private static String portType = "gnu.io.RXTXPort";
	
	private static SerialPort sp;

	public static void main(String[] args) {
		// TODO Auto-generated method stub

		List<CommPortIdentifier> commPortsList = SerialPortTools.findSerialPorts();
		
		if(commPortsList.isEmpty()) {
			//If no serial port has been found
			System.out.println("Impossible to find a port.\n");
			return;
		}
		
		for(CommPortIdentifier cpi : commPortsList) {
			if(cpi.getName().compareTo(commPortName) == 0) {
			//If this port is the chosen one
				sp = SerialPortTools.initSerialPort(cpi, SerialPortTools.serialPortSettings);
				System.out.println("Chosen port "+cpi.getName()+" initialized.\n");
			}
		}
		
		if(sp == null) {
			System.out.println("Impossible to initialize the port "+commPortsList.get(0).getName()+".\n");
		}
		
		String message = "Hello world!";
		byte [] flow = message.getBytes();
			
		try {
			OutputStream outputStream = sp.getOutputStream();
			outputStream.write(flow);
			} catch (IOException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}		
		
			System.out.println("Your message has been sent to the chosen port.\n");
	}
}
